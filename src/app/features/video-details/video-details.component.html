<div class="video-details-container">
    <div class="watch-comment-section">
        <div class='watch-section'>
            <video [src]="videoDetails?.videoPath" controls width="100%"></video>

            <h1 class="video-title">{{videoDetails?.title}}</h1>

            <div class="tags" *ngIf="videoTags.length">
                <span class="tag-pill" *ngFor="let tag of videoTags">{{ tag }}</span>
            </div>
            <div class="watch-metadata">
                <span class="channel">
                    <mat-icon>person</mat-icon>
                    <a *ngIf="videoDetails?.authorUsername" [routerLink]="['/profile', videoDetails!.authorUsername]">
                      {{videoDetails?.authorUsername}}
                    </a>
                </span>

                <span class="watch-metadata-controls">
                    <span class="view-count">
                        <mat-icon>remove_red_eye</mat-icon> {{videoDetails?.viewCount}} 
                    </span>
                    <span class="created-date">
                        {{videoDetails?.createdAt | date:'dd.MM.yyyy'}}
                    </span>
                    <span class="like-dislike">
                        <span class="like" (click)="handleLike()" [class.liked]="likedByUser">
                            <mat-icon>{{ likedByUser ? 'thumb_up' : 'thumb_up_off_alt' }}</mat-icon>
                            <span class="like-count">{{ likeCount }}</span>
                        </span>
                    </span>
                    <span class="share">
                        <mat-icon>share</mat-icon>
                    </span>
                </span>
            </div>
            <div class="video-description">
                <h4>Opis</h4>
                <p>{{videoDetails?.description}}</p>
            </div>
        </div>
        <div class="comment-section">
            <h3 class="comment-title">Komentari</h3>
            
            <!-- Forma za dodavanje komentara -->
            <div class="add-comment">
                <textarea 
                    [formControl]="commentControl"
                    placeholder="Dodaj komentar..."
                    rows="3"
                    class="comment-input"
                ></textarea>
                <button 
                    (click)="submitComment()" 
                    [disabled]="commentControl.invalid"
                    class="comment-submit-btn"
                >
                    Komentariši
                </button>
            </div>

            <!-- Lista komentara -->
            <div class="comments-list">
                <div *ngIf="loadingComments" class="loading-comments">Učitavanje komentara...</div>
                
                <div *ngIf="!loadingComments && comments.length === 0" class="no-comments">
                    Nema komentara. Budite prvi koji će komentarisati!
                </div>

                <div *ngIf="comments.length > 0" class="comments-count">
                    Prikazano {{ comments.length }} od {{ totalComments }} komentara
                </div>

                <div *ngFor="let comment of comments" class="comment-item">
                    <div class="comment-header">
                        <span class="comment-author">
                            <mat-icon>account_circle</mat-icon>
                            <a [routerLink]="['/profile', comment.authorUsername]">
                                {{ comment.authorUsername }}
                            </a>
                        </span>
                        <span class="comment-time">{{ getTimeAgo(comment.createdAt) }}</span>
                    </div>
                    <div class="comment-content">{{ comment.content }}</div>
                    <div class="comment-actions" *ngIf="canDeleteComment(comment)">
                        <button (click)="deleteComment(comment.id)" class="delete-comment-btn">
                            <mat-icon>delete</mat-icon>
                            Obriši
                        </button>
                    </div>
                </div>

                <!-- Dugme za učitavanje više komentara -->
                <button 
                    *ngIf="totalCommentPages > 1 && commentPage < totalCommentPages - 1" 
                    (click)="loadMoreComments()"
                    class="load-more-btn"
                    [disabled]="loadingComments"
                >
                    Prikaži još komentara
                </button>
            </div>
        </div>
    </div>
    
    <div class="suggested-section">
        <h2>Preporučujemo</h2>
        <div class="suggested-videos">
            <a
                class="suggested-card"
                *ngFor="let video of suggestedVideos"
                [routerLink]="['/watch', video.draftId]"
            >
                <div class="suggested-thumbnail">
                    <img
                        [src]="getThumbnailUrl(video.draftId)"
                        [alt]="video.title"
                    />
                </div>
                <div class="suggested-info">
                    <h3 class="suggested-title">{{ video.title }}</h3>
                    <p class="suggested-meta">
                        {{ video.authorUsername }} 
                        • {{ video.viewCount }} pregleda 
                        • {{ video.createdAt | date:'dd.MM.yyyy' }}
                    </p>
                </div>
            </a>
        </div>
    </div>
</div>
